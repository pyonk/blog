<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.49" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/blog/css/normalize.css">
<link rel="stylesheet" href="/blog/css/skeleton.css">
<link rel="stylesheet" href="/blog/css/custom.css">
<link rel="stylesheet" href="/blog/css/icomoon.css">
<link rel="stylesheet" href="/blog/css/syntax.css">
<link rel="alternate" href="/index.xml" type="application/rss+xml" title="わいがかいた">
<title>Unityのscrollrectでスクロールができない件 - わいがかいた</title>
</head>
<body>

<div class="container">

    <header role="banner">
        <div class="header-logo">
            <a href="/blog"><img src="/blog/images/prof.jpg" width="60" height="60" alt="わいがかいた"></a>
        </div>
        
    </header>


    <main role="main">
        <article itemscope itemtype="http://schema.org/BlogPosting">
            <h1 class="entry-title" itemprop="headline">Unityのscrollrectでスクロールができない件</h1>
            <span class="entry-meta"><time itemprop="datePublished" datetime="2018-11-05">November 05, 2018</time><dl class="entry-categories"><dt class="category"><a href="/blog/categories/%e6%97%a5%e8%a8%98">日記</a></dt></dl></span>
            
            <dl class="entry-tags">
                
                <dt class="tag"><a href="/blog/tags/unity">#unity</a></dt>
                
                <dt class="tag"><a href="/blog/tags/c#">#c#</a></dt>
                
            </dl>
            
            <section itemprop="entry-text">
                

<p>最近仕事でUnityを触るようになってC#を書いているけど、なかなかにUnityのお作法になれない。
普段webをやってるのでCSSみたいに簡単にレイアウトしたり、javascriptみたいにかければいいのにと何度思ったことか・・。</p>

<hr />

<p>タイトルの通りなのだけど、自分の備忘録がわりにメモしておこうと思う。</p>

<h2 id="スクロールができないゾ">スクロールができないゾ</h2>

<p>ボタンを内包するスクロールビューが必要になった。<br />
とりあえずボタンなしでスクロールビューを書いてきちんとスクロールできることを確認した。<br />
いよいよボタンを、とボタンの機能自体は問題なくできてさーてスクロールも確認しておこうと思ったところ、うんともすんとも言わない。<br />
これは困った<br />
すこし調べてみると世界中の人が困ってる風だ。</p>

<p><a href="https://hexadrive.jp/hexablog/program/15948/" title="UnityのScrollRectを拡張しよう | 株式会社ヘキサドライブ | HEXADRIVE | ゲーム制作を中心としたコンテンツクリエイト会社" target="_blank">UnityのScrollRectを拡張しよう | 株式会社ヘキサドライブ | HEXADRIVE | ゲーム制作を中心としたコンテンツクリエイト会社</a></p>

<h2 id="違う違うそうじゃない">違う違うそうじゃない</h2>

<p>似てる問題っぽいけど違う（なんならこの見出しが書きたかっただけ）。
僕の症状はボタンは押せるけどスクロールができない、だ。</p>

<p>参考になったのはこちら</p>

<p><a href="http://answers.unity.com/questions/902929/scroll-not-working-when-elements-inside-have-click.html" title="[Solved] Scroll not working when elements inside have click events - Unity Answers" target="_blank">[Solved] Scroll not working when elements inside have click events - Unity Answers</a></p>

<p>結論、書いてるコードに問題があった。</p>

<ul>
<li>実際のコード</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-cs" data-lang="cs"><span class="n">EventTrigger</span> <span class="n">tapEvent</span> <span class="p">=</span> <span class="n">TitleTextObject</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">EventTrigger</span><span class="p">&gt;();</span>
<span class="n">EventTrigger</span><span class="p">.</span><span class="n">Entry</span> <span class="n">entry</span> <span class="p">=</span> <span class="k">new</span> <span class="n">EventTrigger</span><span class="p">.</span><span class="n">Entry</span><span class="p">();</span>
<span class="n">entry</span><span class="p">.</span><span class="n">eventID</span> <span class="p">=</span> <span class="n">EventTriggerType</span><span class="p">.</span><span class="n">PointerClick</span><span class="p">;</span>
<span class="n">entry</span><span class="p">.</span><span class="n">callback</span><span class="p">.</span><span class="n">AddListener</span><span class="p">((</span><span class="n">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="n">tapHandler</span><span class="p">((</span><span class="n">PointerEventData</span><span class="p">)</span><span class="n">data</span><span class="p">);</span> <span class="p">});</span>
<span class="n">tapEvent</span><span class="p">.</span><span class="n">triggers</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">entry</span><span class="p">);</span></code></pre></div>
<p>一見正しいけど、この<code>EventTrigger</code>っていうのが曲者でいろんな継承が行われてるみたい</p>

<blockquote>
<p>public class EventTrigger : MonoBehaviour, IEventSystemHandler, IPointerEnterHandler, IPointerExitHandler, IPointerDownHandler, IPointerUpHandler, IPointerClickHandler, IDragHandler, IDropHandler, IScrollHandler, IUpdateSelectedHandler, ISelectHandler, IDeselectHandler, IMoveHandler {</p>
</blockquote>

<p>ひょえ〜、でもってこれの<code>IDropHandler</code>, <code>IScrollHandler</code>がスクロールビューに影響を与えていたっぽい。</p>

<p>ということで、いい感じにしたのがこちら</p>
<div class="highlight"><pre class="chroma"><code class="language-cs" data-lang="cs"><span class="k">public</span> <span class="k">class</span> <span class="nc">ClickTrigger</span> <span class="p">:</span> <span class="n">MonoBehaviour</span><span class="p">,</span> <span class="n">IPointerClickHandler</span> <span class="p">{</span>
    <span class="k">public</span> <span class="n">System</span><span class="p">.</span><span class="n">Action</span><span class="p">&lt;</span><span class="n">PointerEventData</span><span class="p">&gt;</span> <span class="n">pointerClickAction</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">void</span> <span class="n">OnPointerClick</span><span class="p">(</span><span class="n">PointerEventData</span> <span class="n">eventData</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">pointerClickAction</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="n">pointerClickAction</span><span class="p">(</span><span class="n">eventData</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="n">AddOnclickEvent</span><span class="p">(</span><span class="n">GameObject</span> <span class="n">target</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Action</span><span class="p">&lt;</span><span class="n">PointerEventData</span><span class="p">&gt;</span> <span class="n">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">target</span><span class="p">.</span><span class="n">AddComponent</span><span class="p">&lt;</span><span class="n">TimelineHelper</span><span class="p">.</span><span class="n">ClickTrigger</span><span class="p">&gt;().</span><span class="n">pointerClickAction</span> <span class="p">=</span> <span class="n">callback</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>
<p><code>AddOnClickEvent</code>したときに、<code>ClickTrigger</code>をアタッチしておくような実装。
ちなみに、すでに<code>ClickTrigger</code>がアタッチしてる場合のことは考えられてないけど一旦目を瞑ろう。</p>

<p>無事にこれで思った通りの動きをしてくれるようになった。
今後、他の処理が必要になったらこんな感じで必要なもののみを継承していく感じでやっていけばいいのかしら。</p>

<p>なれないけどがんばるぞ〜〜。</p>

            </section>
        </article>
    </main>


    <footer role="contentinfo">
        <div class="hr"></div>
        <div class="footer-link">
            
            <a href="https://twitter.com/yukieroero" target="_blank"><i class="icon-twitter"></i></a>
            <a href="https://facebook.com/yukiyoshiokap" target="_blank"><i class="icon-facebook2"></i></a>
            <a href="https://github.com/pyonk" target="_blank"><i class="icon-github"></i></a>
        </div>
        <div class="copyright">Copyright &copy; pyonk</div>
    </footer>

</div>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-85825684-1', 'auto');
    ga('send', 'pageview');
</script>



</body>
</html>

