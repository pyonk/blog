<!DOCTYPE html>
<html lang="ja">
<head>
  
    <title>minio is awesome :: わいがかいた</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="S3使うにあたってローカル環境でもS3使わんといかんのかな〜って思って検索したらminioというS3互換のオブジェクトストレージがあったhttps://t.co/YLKdJrsasg
&amp;mdash; ヨシオカユウキ (@pyonknoyp) April 14, 2019  以前GCSを使っているときにローカルでテストするたびにテストデータがGCS上に溜まっていくのが嫌だなあ〜って思ってた。
S3に鞍替えしようと思って少し調べてみると、S3互換のオブジェクトストレージがあるらしい。 docker-composeと相性も良さそうなので使ってみることにした。
ちなみにDjangoでウェブサイトを構築している。
下準備 $ pip install django-storages boto3  python側で追加インストール必要なのはこれだけで あとはsettings.py
# S3にアップロード DEFAULT_FILE_STORAGE = &#39;storages.backends.s3boto3.S3Boto3Storage&#39; AWS_ACCESS_KEY_ID = &#39;minio&#39; # 自由に決めちゃっておk AWS_SECRET_ACCESS_KEY = &#39;minio123&#39; # 自由に決めちゃっておk AWS_STORAGE_BUCKET_NAME = &#39;static&#39; # 自由に決めちゃっておk AWS_S3_ENDPOINT_URL = &#39;http://minio:9000/&#39;  minio本体はdocker imageを利用するのが便利。
docker-compose.ymlに以下の記述を追加する。
version: &#39;3.2&#39; services: minio: image: minio/minio ports: - &amp;quot;9000:9000&amp;quot; volumes: - type: volume source: minio target: /export environment: MINIO_ACCESS_KEY: minio MINIO_SECRET_KEY: minio123 command: server /export volumes: minio:  これでdocker-compose upするとminioが立ち上がるので localhost:9000にアクセスしてstaticバケットを作っておく。"/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://pyonk.github.io/blog/posts/minio-is-awesome/" />


<link rel="stylesheet" href="https://pyonk.github.io/blog/assets/style.css">


<link rel="stylesheet" href="https://pyonk.github.io/blog/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://pyonk.github.io/blog/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://pyonk.github.io/blog/img/favicon.png">


<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="minio is awesome :: わいがかいた — " />
<meta name="twitter:description" content="S3使うにあたってローカル環境でもS3使わんといかんのかな〜って思って検索したらminioというS3互換のオブジェクトストレージがあったhttps://t.co/YLKdJrsasg
&amp;mdash; ヨシオカユウキ (@pyonknoyp) April 14, 2019  以前GCSを使っているときにローカルでテストするたびにテストデータがGCS上に溜まっていくのが嫌だなあ〜って思ってた。
S3に鞍替えしようと思って少し調べてみると、S3互換のオブジェクトストレージがあるらしい。 docker-composeと相性も良さそうなので使ってみることにした。
ちなみにDjangoでウェブサイトを構築している。
下準備 $ pip install django-storages boto3  python側で追加インストール必要なのはこれだけで あとはsettings.py
# S3にアップロード DEFAULT_FILE_STORAGE = &#39;storages.backends.s3boto3.S3Boto3Storage&#39; AWS_ACCESS_KEY_ID = &#39;minio&#39; # 自由に決めちゃっておk AWS_SECRET_ACCESS_KEY = &#39;minio123&#39; # 自由に決めちゃっておk AWS_STORAGE_BUCKET_NAME = &#39;static&#39; # 自由に決めちゃっておk AWS_S3_ENDPOINT_URL = &#39;http://minio:9000/&#39;  minio本体はdocker imageを利用するのが便利。
docker-compose.ymlに以下の記述を追加する。
version: &#39;3.2&#39; services: minio: image: minio/minio ports: - &amp;quot;9000:9000&amp;quot; volumes: - type: volume source: minio target: /export environment: MINIO_ACCESS_KEY: minio MINIO_SECRET_KEY: minio123 command: server /export volumes: minio:  これでdocker-compose upするとminioが立ち上がるので localhost:9000にアクセスしてstaticバケットを作っておく。" />
<meta name="twitter:site" content="https://pyonk.github.io/blog/" />
<meta name="twitter:creator" content="pyonk" />
<meta name="twitter:image" content="https://pyonk.github.io/blog/posts/minio-is-awesome/images/minio_gui.png">


<meta property="og:locale" content="ja" />
<meta property="og:type" content="article" />
<meta property="og:title" content="minio is awesome :: わいがかいた — ">
<meta property="og:description" content="S3使うにあたってローカル環境でもS3使わんといかんのかな〜って思って検索したらminioというS3互換のオブジェクトストレージがあったhttps://t.co/YLKdJrsasg
&amp;mdash; ヨシオカユウキ (@pyonknoyp) April 14, 2019  以前GCSを使っているときにローカルでテストするたびにテストデータがGCS上に溜まっていくのが嫌だなあ〜って思ってた。
S3に鞍替えしようと思って少し調べてみると、S3互換のオブジェクトストレージがあるらしい。 docker-composeと相性も良さそうなので使ってみることにした。
ちなみにDjangoでウェブサイトを構築している。
下準備 $ pip install django-storages boto3  python側で追加インストール必要なのはこれだけで あとはsettings.py
# S3にアップロード DEFAULT_FILE_STORAGE = &#39;storages.backends.s3boto3.S3Boto3Storage&#39; AWS_ACCESS_KEY_ID = &#39;minio&#39; # 自由に決めちゃっておk AWS_SECRET_ACCESS_KEY = &#39;minio123&#39; # 自由に決めちゃっておk AWS_STORAGE_BUCKET_NAME = &#39;static&#39; # 自由に決めちゃっておk AWS_S3_ENDPOINT_URL = &#39;http://minio:9000/&#39;  minio本体はdocker imageを利用するのが便利。
docker-compose.ymlに以下の記述を追加する。
version: &#39;3.2&#39; services: minio: image: minio/minio ports: - &amp;quot;9000:9000&amp;quot; volumes: - type: volume source: minio target: /export environment: MINIO_ACCESS_KEY: minio MINIO_SECRET_KEY: minio123 command: server /export volumes: minio:  これでdocker-compose upするとminioが立ち上がるので localhost:9000にアクセスしてstaticバケットを作っておく。" />
<meta property="og:url" content="https://pyonk.github.io/blog/posts/minio-is-awesome/" />
<meta property="og:site_name" content="minio is awesome" />
<meta property="og:image" content="https://pyonk.github.io/blog/posts/minio-is-awesome/images/minio_gui.png">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">

<meta property="article:published_time" content="2019-04-15 15:42:13 &#43;0900 JST" />








<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-85825684-1', 'auto');
ga('send', 'pageview');

</script>


</head>
<body class="">
<div class="container">
  <header class="header">
  <span class="header__inner">
    <a href="/blog/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#000" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">わいがかいた</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


  <div class="content">
    
  <div class="post">
    <h2 class="post-title"><a href="https://pyonk.github.io/blog/posts/minio-is-awesome/">minio is awesome</a></h2>
    <div class="post-meta">
      
        <span class="post-date">
            2019-04-15
        </span>
      
      <span class="post-author">— Written by pyonk</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="https://pyonk.github.io/blog/tags/minio">minio</a>&nbsp;
        
          #<a href="https://pyonk.github.io/blog/tags/infra">infra</a>&nbsp;
        
          #<a href="https://pyonk.github.io/blog/tags/development">development</a>&nbsp;
        
      </span>
    

    
      <img src="https://pyonk.github.io/blog/posts/minio-is-awesome/images/minio_gui.png" class="post-cover" />
    

    <div class="post-content">
      

<blockquote class="twitter-tweet"><p lang="ja" dir="ltr">S3使うにあたってローカル環境でもS3使わんといかんのかな〜って思って検索したらminioというS3互換のオブジェクトストレージがあった<a href="https://t.co/YLKdJrsasg">https://t.co/YLKdJrsasg</a></p>&mdash; ヨシオカユウキ (@pyonknoyp) <a href="https://twitter.com/pyonknoyp/status/1117441566258282496?ref_src=twsrc%5Etfw">April 14, 2019</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>以前GCSを使っているときにローカルでテストするたびにテストデータがGCS上に溜まっていくのが嫌だなあ〜って思ってた。</p>

<p>S3に鞍替えしようと思って少し調べてみると、S3互換のオブジェクトストレージがあるらしい。
docker-composeと相性も良さそうなので使ってみることにした。</p>

<p>ちなみにDjangoでウェブサイトを構築している。</p>

<h2 id="下準備">下準備</h2>

<pre><code class="language-shell">$ pip install django-storages boto3
</code></pre>

<p>python側で追加インストール必要なのはこれだけで
あとはsettings.py</p>

<pre><code class="language-python"># S3にアップロード
DEFAULT_FILE_STORAGE = 'storages.backends.s3boto3.S3Boto3Storage'
AWS_ACCESS_KEY_ID = 'minio' # 自由に決めちゃっておk
AWS_SECRET_ACCESS_KEY = 'minio123' # 自由に決めちゃっておk
AWS_STORAGE_BUCKET_NAME = 'static' # 自由に決めちゃっておk
AWS_S3_ENDPOINT_URL = 'http://minio:9000/'
</code></pre>

<p>minio本体はdocker imageを利用するのが便利。</p>

<p>docker-compose.ymlに以下の記述を追加する。</p>

<pre><code class="language-yaml">version: '3.2'
services:
  minio:
    image: minio/minio
    ports:
      - &quot;9000:9000&quot;
    volumes:
      - type: volume
        source: minio
        target: /export
    environment:
      MINIO_ACCESS_KEY: minio
      MINIO_SECRET_KEY: minio123
    command: server /export

volumes:
  minio:
</code></pre>

<p>これで<code>docker-compose up</code>するとminioが立ち上がるので
localhost:9000にアクセスして<code>static</code>バケットを作っておく。</p>

<p>準備は以上。簡単！！</p>

<h2 id="uploader">Uploader</h2>

<p>以下のようなUploaderを用意しておけば</p>

<pre><code class="language-python">from django.core.files.storage import default_storage

class Uploader:

    storage = default_storage
    filename = ''
    url = ''

    def __init__(self):
        pass

    def get_unique_filename(self, filename):
        return self.storage.get_available_name(filename)

    def upload(self, uploaded_file):
        self.filename = self.get_unique_filename(uploaded_file.name)
        with self.storage.open(self.filename, 'w') as f:
            for chunk in uploaded_file.chunks():
                f.write(chunk)
        self.url = self.storage.url(self.filename)
        return self.url
</code></pre>

<p>こんな感じで使うといい感じ。</p>

<pre><code class="language-python">from django.core.files.uploadedfile import UploadedFile
from uploader import Uploader

test_file = open('./hoge.txt', 'r')
uploaded_file = UploadedFile(test_file)
uploader = Uploader()
uploader.upload(uploaded_file)
</code></pre>

<p>とっても便利なminioでした。</p>

<p>もちろん本番でS3使う場合は色々設定いじる必要があるけど
環境に応じて設定ファイルを使い分ければそんなに手間ではないかな。</p>

<p><a href="https://stackoverflow.com/questions/4909958/django-local-settings/4909964#4909964">https://stackoverflow.com/questions/4909958/django-local-settings/4909964#4909964</a></p>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
          
            <span class="button next">
              <a href="https://pyonk.github.io/blog/posts/vista-vim-is-awesome/">
                <span class="button__text">vista.vim is awesome</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

    </div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <a href="/blog/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" width="44" height="44" viewBox="0 0 44 44">
  <polyline fill="none" stroke="#000" stroke-width="2" points="15 8 29.729 22.382 15 35.367"/>
</svg>
</span>
    <span class="logo__text">わいがかいた</span>
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span>© 2019 Powered by <a href="http://gohugo.io">Hugo</a></span>
        <span>Theme created by <a href="https://twitter.com/panr">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="https://pyonk.github.io/blog/assets/main.js"></script>
<script src="https://pyonk.github.io/blog/assets/prism.js"></script>

  
</div>

</body>
</html>
