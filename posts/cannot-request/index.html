<!doctype html><html lang=ja><head><title>あ！ やせいの requests.exceptions.SSLErrorが とびだしてきた！ ::
わいがかいた
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="あるサイトをクロールして情報を集めようと思ってpythonでプログラムを書いていたのですが、思わぬところでハマったので備忘録代わりに。
ナゾのrequests.exceptions.SSLError # それなりにpythonのrequestsをつかってクローラーを書いていたのですぐできるワイヤ。と思っていたのですが、実行した途端にナゾのrequests.exceptions.SSLErrorが発生しました。
requests.exceptions.SSLError: hostname 'damedayo.com' doesn't match either of 'www.kore.com', 'kore.com'
おやおや、SSLErrorですから、なにかセキュリティ周りのエラーであることが予測できます。 さらにホスト名が違うことから、バーチャルホストを利用しているためにSSL証明書のhostが違うよっていうことなんでしょうか。
とりあえずverify=Falseを指定しても一度チャレンジです。
import requests req = requests.get(&amp;#39;https://damedayo.com/&amp;#39;, verify=False) print req.text するとresponseが帰ってきました。
The client software did not provide a hostname using Server Name Indication (SNI), which is required to access this server. はーーーーんんんんんんん
何はともあれ、ググります。
みっけた。
ん〜〜〜やはりバーチャルホスト周りっぽい。 というかpythonのバージョンが2.7.9以上であれば問題ないんか。コレ。
解決策としてStack Overflowへのリンクが貼ってありますね。こういうこともあるのね。初めて見た。
pip install pyOpenSSLで詰む # pyOpenSSLとidnaをインストールしてあげるとよいよってあるのでやってみました。
idnaはすっきり入ってくれたのですがpyOpenSSLが上手くいかない。。(すでに入っていたためバージョンをあげています。)
$ pip install pyOpenSSL --upgrade .....前略..... 1 warning and 20 errors generated. error: command &amp;#39;cc&amp;#39; failed with exit status 1 ---------------------------------------- Failed building wheel for cryptography ."><meta name=keywords content="わいがかいた"><meta name=robots content="noodp"><link rel=canonical href=https://pyonk.github.io/blog/posts/cannot-request/><link rel=stylesheet href=https://pyonk.github.io/blog/assets/style.css><link rel=stylesheet href=https://pyonk.github.io/blog/style.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=https://pyonk.github.io/blog/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=https://pyonk.github.io/blog/img/favicon.png><link href=https://pyonk.github.io/blog/assets/fonts/Inter-Italic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://pyonk.github.io/blog/assets/fonts/Inter-Regular.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://pyonk.github.io/blog/assets/fonts/Inter-Medium.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://pyonk.github.io/blog/assets/fonts/Inter-MediumItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://pyonk.github.io/blog/assets/fonts/Inter-Bold.woff2 rel=preload type=font/woff2 as=font crossorigin><link href=https://pyonk.github.io/blog/assets/fonts/Inter-BoldItalic.woff2 rel=preload type=font/woff2 as=font crossorigin><meta name=twitter:card content="summary"><meta name=twitter:title content="あ！ やせいの requests.exceptions.SSLErrorが とびだしてきた！"><meta name=twitter:description content="あ！ やせいの requests.exceptions.SSLErrorが とびだしてきた！ pyonk は どうする？"><meta property="og:url" content="https://pyonk.github.io/blog/posts/cannot-request/"><meta property="og:site_name" content="わいがかいた"><meta property="og:title" content="あ！ やせいの requests.exceptions.SSLErrorが とびだしてきた！"><meta property="og:description" content="あ！ やせいの requests.exceptions.SSLErrorが とびだしてきた！ pyonk は どうする？"><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-02-02T18:40:16+09:00"><meta property="article:modified_time" content="2017-02-02T18:40:16+09:00"><meta property="article:tag" content="Python"><link rel=stylesheet src=static/style.css></head><body class=light-theme><div class=container><header class=header><span class=header__inner><a href=/blog/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span><span class=logo__text>わいがかいた</span>
<span class=logo__cursor></span>
</a><span class=header__right><span class=theme-toggle><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span></span></span></header><div class=content><div class=post><h1 class=post-title>あ！ やせいの requests.exceptions.SSLErrorが とびだしてきた！</h1><div class=post-meta><span class=post-date>2017-02-02
</span><span class=post-read-time>— 2 min read</span></div><span class=post-tags><a href=https://pyonk.github.io/blog/tags/python/>#python</a>&nbsp;</span><div class=post-content><p>あるサイトをクロールして情報を集めようと思ってpythonでプログラムを書いていたのですが、思わぬところでハマったので備忘録代わりに。</p><h1 id=ナゾのrequestsexceptionssslerror>ナゾのrequests.exceptions.SSLError
<a href=#%e3%83%8a%e3%82%be%e3%81%aerequestsexceptionssslerror class=h-anchor aria-hidden=true>#</a></h1><p>それなりにpythonの<a href=http://docs.python-requests.org/en/master/>requests</a>をつかってクローラーを書いていたのですぐできるワイヤ。と思っていたのですが、実行した途端にナゾの<code>requests.exceptions.SSLError</code>が発生しました。</p><p><code>requests.exceptions.SSLError: hostname 'damedayo.com' doesn't match either of 'www.kore.com', 'kore.com'</code></p><p>おやおや、SSLErrorですから、なにかセキュリティ周りのエラーであることが予測できます。
さらにホスト名が違うことから、バーチャルホストを利用しているためにSSL証明書のhostが違うよっていうことなんでしょうか。</p><p>とりあえず<code>verify=False</code>を指定しても一度チャレンジです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>req <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;https://damedayo.com/&#39;</span>, verify<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>print req<span style=color:#f92672>.</span>text
</span></span></code></pre></div><p>するとresponseが帰ってきました。</p><p><code>The client software did not provide a hostname using Server Name Indication (SNI), which is required to access this server.</code></p><p>はーーーーんんんんんんん</p><p>何はともあれ、ググります。</p><p><a href=http://docs.python-requests.org/en/latest/community/faq/#what-are-hostname-doesn-t-match-errors>みっけた</a>。</p><p>ん〜〜〜やはりバーチャルホスト周りっぽい。
というか<strong>pythonのバージョンが<code>2.7.9</code>以上であれば問題ないんか</strong>。コレ。</p><p>解決策として<a href=https://stackoverflow.com/questions/18578439/using-requests-with-tls-doesnt-give-sni-support/18579484#18579484>Stack Overflowへのリンク</a>が貼ってありますね。こういうこともあるのね。初めて見た。</p><h1 id=pip-install-pyopensslで詰む>pip install pyOpenSSLで詰む
<a href=#pip-install-pyopenssl%e3%81%a7%e8%a9%b0%e3%82%80 class=h-anchor aria-hidden=true>#</a></h1><p>pyOpenSSLとidnaをインストールしてあげるとよいよってあるのでやってみました。</p><p>idnaはすっきり入ってくれたのですがpyOpenSSLが上手くいかない。。(すでに入っていたためバージョンをあげています。)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pip install pyOpenSSL --upgrade
</span></span><span style=display:flex><span>.....前略.....
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> warning and <span style=color:#ae81ff>20</span> errors generated.
</span></span><span style=display:flex><span>error: command <span style=color:#e6db74>&#39;cc&#39;</span> failed with exit status <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>----------------------------------------
</span></span><span style=display:flex><span>Failed building wheel <span style=color:#66d9ef>for</span> cryptography
</span></span><span style=display:flex><span>.....中略.....
</span></span><span style=display:flex><span>----------------------------------------
</span></span><span style=display:flex><span>Command <span style=color:#e6db74>&#34;/usr/bin/python -c &#34;</span>import setuptools, tokenize;__file__<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;/private/tmp/pip-build-OtiuE0/cryptography/setup.py&#39;</span>;exec<span style=color:#f92672>(</span>compile<span style=color:#f92672>(</span>getattr<span style=color:#f92672>(</span>tokenize, <span style=color:#e6db74>&#39;open&#39;</span>, open<span style=color:#f92672>)(</span>__file__<span style=color:#f92672>)</span>.read<span style=color:#f92672>()</span>.replace<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;\r\n&#39;</span>, <span style=color:#e6db74>&#39;\n&#39;</span><span style=color:#f92672>)</span>, __file__, <span style=color:#e6db74>&#39;exec&#39;</span><span style=color:#f92672>))</span><span style=color:#e6db74>&#34; install --record /tmp/pip-1pK2m3-record/install-record.txt --single-version-externally-managed --compile&#34;</span> failed with error code <span style=color:#ae81ff>1</span> in /private/tmp/pip-build-OtiuE0/cryptography
</span></span></code></pre></div><p>gccがないよっていうのは見たことありましたが、ccがないよって初めて見ました。</p><p>ともあれcryptographyのインストールに失敗しているみたいです。</p><p>ぐぐります。</p><p>例によって<a href=http://stackoverflow.com/questions/22073516/failed-to-install-python-cryptography-package-with-pip-and-setup-py>Stack Overflow</a>です。</p><h2 id=opensslのアップデートで詰まる>openSSLのアップデートで詰まる
<a href=#openssl%e3%81%ae%e3%82%a2%e3%83%83%e3%83%97%e3%83%87%e3%83%bc%e3%83%88%e3%81%a7%e8%a9%b0%e3%81%be%e3%82%8b class=h-anchor aria-hidden=true>#</a></h2><p>openSSLのバージョンが古いのかもと思ってアップデートしました。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ brew upgrade openssl
</span></span><span style=display:flex><span>$ brew link openssl --force
</span></span><span style=display:flex><span>Warning: Refusing to link: openssl
</span></span><span style=display:flex><span>Linking keg-only openssl means you may end up linking against the insecure,
</span></span><span style=display:flex><span>deprecated system OpenSSL <span style=color:#66d9ef>while</span> using the headers from Homebrew<span style=color:#960050;background-color:#1e0010>&#39;</span>s openssl.
</span></span><span style=display:flex><span>Instead, pass the full include/library paths to your compiler e.g.:
</span></span><span style=display:flex><span>  -I/usr/local/opt/openssl/include -L/usr/local/opt/openssl/lib
</span></span><span style=display:flex><span>$ which openssl
</span></span><span style=display:flex><span>/usr/bin/openssl
</span></span></code></pre></div><p>ウーーン詰まる詰まる。</p><p>いまはこの方法で<a href=http://qiita.com/dasisyouyu/items/c9621c29b0fe79d2b7c4>opensslへのリンクがはれない</a>ようです。。</p><p>PATHを通してあげます。</p><pre tabindex=0><code>export PATH=&#34;/usr/local/opt/openssl/bin:$HOME/.pyenv/bin:$PATH&#34;
</code></pre><p>確認します。</p><pre tabindex=0><code>$ which openssl
/usr/local/opt/openssl/bin/openssl
</code></pre><p>つぎ！</p><h2 id=pipのアップデート>pipのアップデート
<a href=#pip%e3%81%ae%e3%82%a2%e3%83%83%e3%83%97%e3%83%87%e3%83%bc%e3%83%88 class=h-anchor aria-hidden=true>#</a></h2><p>さきほどのStack Overflowでは、pipのバージョンあげなよとあったのでアップデートです。</p><pre tabindex=0><code>$ pip install --upgrade pip
</code></pre><p>さっくり詰まることなくクリアしました。</p><h2 id=そして大本営に突撃>そして大本営に突撃
<a href=#%e3%81%9d%e3%81%97%e3%81%a6%e5%a4%a7%e6%9c%ac%e5%96%b6%e3%81%ab%e7%aa%81%e6%92%83 class=h-anchor aria-hidden=true>#</a></h2><p>ようやくcryptograph(おぼえた)をインストールする手はずが整いました。</p><pre tabindex=0><code>$ pip install pyOpenSSL --upgrade
</code></pre><p>ばっちり！！アップデートできたっぽい！！！！</p><p>いざ！！</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>req <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;https://damedayo.com/&#39;</span>, verify<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>print req<span style=color:#f92672>.</span>text
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Traceback (most recent call last):
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;eroge_translation_helpman.py&#34;</span>, line <span style=color:#ae81ff>3</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/requests/__init__.py&#34;</span>, line <span style=color:#ae81ff>52</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>from</span> .packages.urllib3.contrib <span style=color:#f92672>import</span> pyopenssl
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/requests/packages/urllib3/contrib/pyopenssl.py&#34;</span>, line <span style=color:#ae81ff>48</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>from</span> cryptography <span style=color:#f92672>import</span> x509
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/cryptography/x509/__init__.py&#34;</span>, line <span style=color:#ae81ff>7</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>from</span> cryptography.x509.base <span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/cryptography/x509/base.py&#34;</span>, line <span style=color:#ae81ff>15</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>from</span> cryptography.hazmat.primitives.asymmetric <span style=color:#f92672>import</span> dsa, ec, rsa
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/cryptography/hazmat/primitives/asymmetric/rsa.py&#34;</span>, line <span style=color:#ae81ff>14</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>from</span> cryptography.hazmat.backends.interfaces <span style=color:#f92672>import</span> RSABackend
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/cryptography/hazmat/backends/__init__.py&#34;</span>, line <span style=color:#ae81ff>7</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>import</span> pkg_resources
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/pkg_resources/__init__.py&#34;</span>, line <span style=color:#ae81ff>72</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>import</span> packaging.requirements
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/packaging/requirements.py&#34;</span>, line <span style=color:#ae81ff>59</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    MARKER_EXPR <span style=color:#f92672>=</span> originalTextFor(MARKER_EXPR())(<span style=color:#e6db74>&#34;marker&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>TypeError</span>: __call__() takes exactly <span style=color:#ae81ff>2</span> arguments (<span style=color:#ae81ff>1</span> given)
</span></span></code></pre></div><p>・・・・・・・・・・・。</p><p>もう。</p><p>ぐぐります・・・・・。</p><p>見つけました。<a href=http://stackoverflow.com/a/41841210>Stack Overflow</a>本当にありがとう。</p><p>setuptoolsが原因だったみたいですね。バージョンによってはエラーが出るようです。</p><pre tabindex=0><code>$ pip install setuptools == 33.1.1
</code></pre><p>ということでこれでようやくプログラムを書き進められそうです。</p><h1 id=さいごに>さいごに
<a href=#%e3%81%95%e3%81%84%e3%81%94%e3%81%ab class=h-anchor aria-hidden=true>#</a></h1><p>というか<code>/etc/hosts</code>をかえたらできたのではないか疑惑が・・・。</p><p>さすがにないかしら。今度時間があったら試してみるでござる。</p></div></div></div><footer class=footer><div class=footer__inner><a href=/blog/ class=logo style=text-decoration:none><span class=logo__mark><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44"><path fill="none" d="M15 8l14.729 14.382L15 35.367"/></svg>
</span><span class=logo__text>わいがかいた</span>
<span class=logo__cursor></span></a><div class=copyright><span>© 2024 Powered by
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a></span>
<span>Theme created by
<a href=https://twitter.com/panr target=_blank rel=noopener>panr</a></span></div></div></footer><script src=https://pyonk.github.io/blog/assets/main.js></script><script src=https://pyonk.github.io/blog/assets/prism.js></script></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-51GX3P4YPL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-51GX3P4YPL")}</script></body></html>