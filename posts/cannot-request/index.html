<!doctype html><html lang=ja><head><title>あ！ やせいの requests.exceptions.SSLErrorが とびだしてきた！ ::
わいがかいた</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="あるサイトをクロールして情報を集めようと思ってpythonでプログラムを書いていたのですが、思わぬところでハマったので備忘録代わりに。
ナゾのrequests.exceptions.SSLError それなりにpythonのrequestsをつかってクローラーを書いていたのですぐできるワイヤ。と思っていたのですが、実行した途端にナゾのrequests.exceptions.SSLErrorが発生しました。
requests.exceptions.SSLError: hostname 'damedayo.com' doesn't match either of 'www.kore.com', 'kore.com'
おやおや、SSLErrorですから、なにかセキュリティ周りのエラーであることが予測できます。 さらにホスト名が違うことから、バーチャルホストを利用しているためにSSL証明書のhostが違うよっていうことなんでしょうか。
とりあえずverify=Falseを指定しても一度チャレンジです。
import requests req = requests.get('https://damedayo.com/', verify=False) print req.text するとresponseが帰ってきました。
The client software did not provide a hostname using Server Name Indication (SNI), which is required to access this server. はーーーーんんんんんんん
何はともあれ、ググります。
みっけた。
ん〜〜〜やはりバーチャルホスト周りっぽい。 というかpythonのバージョンが2.7.9以上であれば問題ないんか。コレ。
解決策としてStack Overflowへのリンクが貼ってありますね。こういうこともあるのね。初めて見た。
pip install pyOpenSSLで詰む pyOpenSSLとidnaをインストールしてあげるとよいよってあるのでやってみました。
idnaはすっきり入ってくれたのですがpyOpenSSLが上手くいかない。。(すでに入っていたためバージョンをあげています。)
$ pip install pyOpenSSL --upgrade .....前略..... 1 warning and 20 errors generated. error: command 'cc' failed with exit status 1 ---------------------------------------- Failed building wheel for cryptography .....中略..... ---------------------------------------- Command &#34;/usr/bin/python -c &#34;import setuptools, tokenize;__file__='/private/tmp/pip-build-OtiuE0/cryptography/setup.py';exec(compile(getattr(tokenize, 'open', open)(__file__).read().replace('\r\n', '\n'), __file__, 'exec'))&#34; install --record /tmp/pip-1pK2m3-record/install-record.txt --single-version-externally-managed --compile&#34; failed with error code 1 in /private/tmp/pip-build-OtiuE0/cryptography gccがないよっていうのは見たことありましたが、ccがないよって初めて見ました。
"><meta name=keywords content="わいがかいた"><meta name=robots content="noodp"><link rel=canonical href=https://pyonk.github.io/blog/posts/cannot-request/><link rel=stylesheet href=/blog/css/style.min.css><link rel=apple-touch-icon-precomposed sizes=144x144 href=/blog/img/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/blog/img/favicon.png><meta name=twitter:card content="summary"><meta name=twitter:title content="あ！ やせいの requests.exceptions.SSLErrorが とびだしてきた！"><meta name=twitter:description content="あ！ やせいの requests.exceptions.SSLErrorが とびだしてきた！ pyonk は どうする？"><meta property="og:url" content="https://pyonk.github.io/blog/posts/cannot-request/"><meta property="og:site_name" content="わいがかいた"><meta property="og:title" content="あ！ やせいの requests.exceptions.SSLErrorが とびだしてきた！"><meta property="og:description" content="あ！ やせいの requests.exceptions.SSLErrorが とびだしてきた！ pyonk は どうする？"><meta property="og:locale" content="ja"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-02-02T18:40:16+09:00"><meta property="article:modified_time" content="2017-02-02T18:40:16+09:00"><meta property="article:tag" content="Python"></head><body class=light-theme><div class=container><header class=header><div class=header__inner><a href=/blog/ class=logo><span class=logo__text>わいがかいた</span></a><div class=header__right><nav class=menu><ul class=menu__inner><li><a href=/blog/gallery/>📷</a></li></ul></nav><div class=menu-toggle-container></div><div class=social-links><a href=https://github.com/pyonk target=_blank rel="noopener noreferrer" class=social-link title=GitHub><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg>
</a><a href=https://www.linkedin.com/in/pyonk target=_blank rel="noopener noreferrer" class=social-link title=LinkedIn><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144.0-2.063-.926-2.063-2.065.0-1.138.92-2.063 2.063-2.063 1.14.0 2.064.925 2.064 2.063.0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg></a></div><div class=theme-toggle-container></div></div></div></header><div class=content><article class=post><header class=post-header><h1 class=post-title>あ！ やせいの requests.exceptions.SSLErrorが とびだしてきた！</h1><div class=post-meta><time datetime=2017-02-02T18:40:16+09:00>2017-02-02
</time><span class=post-reading-time>· 2 分で読める</span></div></header><div class=post-content><p>あるサイトをクロールして情報を集めようと思ってpythonでプログラムを書いていたのですが、思わぬところでハマったので備忘録代わりに。</p><h1 id=ナゾのrequestsexceptionssslerror>ナゾのrequests.exceptions.SSLError</h1><p>それなりにpythonの<a href=http://docs.python-requests.org/en/master/>requests</a>をつかってクローラーを書いていたのですぐできるワイヤ。と思っていたのですが、実行した途端にナゾの<code>requests.exceptions.SSLError</code>が発生しました。</p><p><code>requests.exceptions.SSLError: hostname 'damedayo.com' doesn't match either of 'www.kore.com', 'kore.com'</code></p><p>おやおや、SSLErrorですから、なにかセキュリティ周りのエラーであることが予測できます。
さらにホスト名が違うことから、バーチャルホストを利用しているためにSSL証明書のhostが違うよっていうことなんでしょうか。</p><p>とりあえず<code>verify=False</code>を指定しても一度チャレンジです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>req <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;https://damedayo.com/&#39;</span>, verify<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>print req<span style=color:#f92672>.</span>text
</span></span></code></pre></div><p>するとresponseが帰ってきました。</p><p><code>The client software did not provide a hostname using Server Name Indication (SNI), which is required to access this server.</code></p><p>はーーーーんんんんんんん</p><p>何はともあれ、ググります。</p><p><a href=http://docs.python-requests.org/en/latest/community/faq/#what-are-hostname-doesn-t-match-errors>みっけた</a>。</p><p>ん〜〜〜やはりバーチャルホスト周りっぽい。
というか<strong>pythonのバージョンが<code>2.7.9</code>以上であれば問題ないんか</strong>。コレ。</p><p>解決策として<a href=https://stackoverflow.com/questions/18578439/using-requests-with-tls-doesnt-give-sni-support/18579484#18579484>Stack Overflowへのリンク</a>が貼ってありますね。こういうこともあるのね。初めて見た。</p><h1 id=pip-install-pyopensslで詰む>pip install pyOpenSSLで詰む</h1><p>pyOpenSSLとidnaをインストールしてあげるとよいよってあるのでやってみました。</p><p>idnaはすっきり入ってくれたのですがpyOpenSSLが上手くいかない。。(すでに入っていたためバージョンをあげています。)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ pip install pyOpenSSL --upgrade
</span></span><span style=display:flex><span>.....前略.....
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> warning and <span style=color:#ae81ff>20</span> errors generated.
</span></span><span style=display:flex><span>error: command <span style=color:#e6db74>&#39;cc&#39;</span> failed with exit status <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>----------------------------------------
</span></span><span style=display:flex><span>Failed building wheel <span style=color:#66d9ef>for</span> cryptography
</span></span><span style=display:flex><span>.....中略.....
</span></span><span style=display:flex><span>----------------------------------------
</span></span><span style=display:flex><span>Command <span style=color:#e6db74>&#34;/usr/bin/python -c &#34;</span>import setuptools, tokenize;__file__<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;/private/tmp/pip-build-OtiuE0/cryptography/setup.py&#39;</span>;exec<span style=color:#f92672>(</span>compile<span style=color:#f92672>(</span>getattr<span style=color:#f92672>(</span>tokenize, <span style=color:#e6db74>&#39;open&#39;</span>, open<span style=color:#f92672>)(</span>__file__<span style=color:#f92672>)</span>.read<span style=color:#f92672>()</span>.replace<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;\r\n&#39;</span>, <span style=color:#e6db74>&#39;\n&#39;</span><span style=color:#f92672>)</span>, __file__, <span style=color:#e6db74>&#39;exec&#39;</span><span style=color:#f92672>))</span><span style=color:#e6db74>&#34; install --record /tmp/pip-1pK2m3-record/install-record.txt --single-version-externally-managed --compile&#34;</span> failed with error code <span style=color:#ae81ff>1</span> in /private/tmp/pip-build-OtiuE0/cryptography
</span></span></code></pre></div><p>gccがないよっていうのは見たことありましたが、ccがないよって初めて見ました。</p><p>ともあれcryptographyのインストールに失敗しているみたいです。</p><p>ぐぐります。</p><p>例によって<a href=http://stackoverflow.com/questions/22073516/failed-to-install-python-cryptography-package-with-pip-and-setup-py>Stack Overflow</a>です。</p><h2 id=opensslのアップデートで詰まる>openSSLのアップデートで詰まる</h2><p>openSSLのバージョンが古いのかもと思ってアップデートしました。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ brew upgrade openssl
</span></span><span style=display:flex><span>$ brew link openssl --force
</span></span><span style=display:flex><span>Warning: Refusing to link: openssl
</span></span><span style=display:flex><span>Linking keg-only openssl means you may end up linking against the insecure,
</span></span><span style=display:flex><span>deprecated system OpenSSL <span style=color:#66d9ef>while</span> using the headers from Homebrew<span style=color:#960050;background-color:#1e0010>&#39;</span>s openssl.
</span></span><span style=display:flex><span>Instead, pass the full include/library paths to your compiler e.g.:
</span></span><span style=display:flex><span>  -I/usr/local/opt/openssl/include -L/usr/local/opt/openssl/lib
</span></span><span style=display:flex><span>$ which openssl
</span></span><span style=display:flex><span>/usr/bin/openssl
</span></span></code></pre></div><p>ウーーン詰まる詰まる。</p><p>いまはこの方法で<a href=http://qiita.com/dasisyouyu/items/c9621c29b0fe79d2b7c4>opensslへのリンクがはれない</a>ようです。。</p><p>PATHを通してあげます。</p><pre tabindex=0><code>export PATH=&#34;/usr/local/opt/openssl/bin:$HOME/.pyenv/bin:$PATH&#34;
</code></pre><p>確認します。</p><pre tabindex=0><code>$ which openssl
/usr/local/opt/openssl/bin/openssl
</code></pre><p>つぎ！</p><h2 id=pipのアップデート>pipのアップデート</h2><p>さきほどのStack Overflowでは、pipのバージョンあげなよとあったのでアップデートです。</p><pre tabindex=0><code>$ pip install --upgrade pip
</code></pre><p>さっくり詰まることなくクリアしました。</p><h2 id=そして大本営に突撃>そして大本営に突撃</h2><p>ようやくcryptograph(おぼえた)をインストールする手はずが整いました。</p><pre tabindex=0><code>$ pip install pyOpenSSL --upgrade
</code></pre><p>ばっちり！！アップデートできたっぽい！！！！</p><p>いざ！！</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>req <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;https://damedayo.com/&#39;</span>, verify<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>print req<span style=color:#f92672>.</span>text
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>Traceback (most recent call last):
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;eroge_translation_helpman.py&#34;</span>, line <span style=color:#ae81ff>3</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/requests/__init__.py&#34;</span>, line <span style=color:#ae81ff>52</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>from</span> .packages.urllib3.contrib <span style=color:#f92672>import</span> pyopenssl
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/requests/packages/urllib3/contrib/pyopenssl.py&#34;</span>, line <span style=color:#ae81ff>48</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>from</span> cryptography <span style=color:#f92672>import</span> x509
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/cryptography/x509/__init__.py&#34;</span>, line <span style=color:#ae81ff>7</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>from</span> cryptography.x509.base <span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/cryptography/x509/base.py&#34;</span>, line <span style=color:#ae81ff>15</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>from</span> cryptography.hazmat.primitives.asymmetric <span style=color:#f92672>import</span> dsa, ec, rsa
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/cryptography/hazmat/primitives/asymmetric/rsa.py&#34;</span>, line <span style=color:#ae81ff>14</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>from</span> cryptography.hazmat.backends.interfaces <span style=color:#f92672>import</span> RSABackend
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/cryptography/hazmat/backends/__init__.py&#34;</span>, line <span style=color:#ae81ff>7</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>import</span> pkg_resources
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/pkg_resources/__init__.py&#34;</span>, line <span style=color:#ae81ff>72</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>import</span> packaging.requirements
</span></span><span style=display:flex><span>  File <span style=color:#e6db74>&#34;/Library/Python/2.7/site-packages/packaging/requirements.py&#34;</span>, line <span style=color:#ae81ff>59</span>, <span style=color:#f92672>in</span> <span style=color:#f92672>&lt;</span>module<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    MARKER_EXPR <span style=color:#f92672>=</span> originalTextFor(MARKER_EXPR())(<span style=color:#e6db74>&#34;marker&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>TypeError</span>: <span style=color:#a6e22e>__call__</span>() takes exactly <span style=color:#ae81ff>2</span> arguments (<span style=color:#ae81ff>1</span> given)
</span></span></code></pre></div><p>・・・・・・・・・・・。</p><p>もう。</p><p>ぐぐります・・・・・。</p><p>見つけました。<a href=http://stackoverflow.com/a/41841210>Stack Overflow</a>本当にありがとう。</p><p>setuptoolsが原因だったみたいですね。バージョンによってはエラーが出るようです。</p><pre tabindex=0><code>$ pip install setuptools == 33.1.1
</code></pre><p>ということでこれでようやくプログラムを書き進められそうです。</p><h1 id=さいごに>さいごに</h1><p>というか<code>/etc/hosts</code>をかえたらできたのではないか疑惑が・・・。</p><p>さすがにないかしら。今度時間があったら試してみるでござる。</p></div><footer class=post-footer><div class=post-tags><a href=/blog/categories/%E3%83%90%E3%83%83%E3%82%AF%E3%82%A8%E3%83%B3%E3%83%89/ class=category-tag>バックエンド
</a><a href=/blog/tags/python/><span class=tag-hash>#</span>python</a></div></footer></article><nav class=pagination-single><div class=pagination-single__prev><span class=pagination-single__direction>← 古い記事</span>
<a href=/blog/posts/python-copy/ class=pagination-single__title>pythonの参照渡しをどうすれば回避できるのか</a></div><div class=pagination-single__next><span class=pagination-single__direction>新しい記事 →</span>
<a href=/blog/posts/difference-of-crontabe-and-etc-crontab/ class=pagination-single__title>crontab -e と /etc/crontab の違い</a></div></nav></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2025 Powered by <a href=https://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/pyonk/blog>Theme</a> made by <a href=https://pyonk.github.io/blog/>わいがかいた</a></span></div></div></footer></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-51GX3P4YPL"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-51GX3P4YPL")}</script><script src=/blog/js/main.min.js></script></body></html>