<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="generator" content="Hugo 0.41" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/blog/css/normalize.css">
<link rel="stylesheet" href="/blog/css/skeleton.css">
<link rel="stylesheet" href="/blog/css/custom.css">
<link rel="stylesheet" href="/blog/css/icomoon.css">
<link rel="stylesheet" href="/blog/css/syntax.css">
<link rel="alternate" href="/index.xml" type="application/rss+xml" title="わいがかいた">
<title>pythonでtupleをつくる - わいがかいた</title>
</head>
<body>

<div class="container">

    <header role="banner">
        <div class="header-logo">
            <a href="/blog"><img src="/blog/images/prof.jpg" width="60" height="60" alt="わいがかいた"></a>
        </div>
        
    </header>


    <main role="main">
        <article itemscope itemtype="http://schema.org/BlogPosting">
            <h1 class="entry-title" itemprop="headline">pythonでtupleをつくる</h1>
            <span class="entry-meta"><time itemprop="datePublished" datetime="2017-01-05">January 05, 2017</time><dl class="entry-categories"><dt class="category"><a href="/blog/categories/%e3%83%90%e3%83%83%e3%82%af%e3%82%a8%e3%83%b3%e3%83%89">バックエンド</a></dt></dl></span>
            
            <dl class="entry-tags">
                
                <dt class="tag"><a href="/blog/tags/python">#python</a></dt>
                
            </dl>
            
            <section itemprop="entry-text">
                

<h1 id="pythonのthreadで引数を渡したい">pythonのthreadで引数を渡したい</h1>

<p><a href="http://d.hatena.ne.jp/salexkidd/20090918" target="_blank">Djangoで時間のかかる処理をスレッド化して逃げ</a>ようとしたのですがうまくいかなかったのでメモ。</p>

<p><code>threading.Thread</code>にはいくつか引数が渡せます。</p>

<ul>
<li>group</li>
<li>target</li>
<li>name</li>
<li>args</li>
<li>kwargs</li>
</ul>

<p>詳しくは<a href="http://docs.python.jp/2/library/threading.html" target="_blank">ここ</a>で。</p>

<p>で、スレッド化したい処理に引数を渡そうと思って下記のように実装しました。</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">command_execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">cmd</span> <span class="c1"># (&#39;s&#39;, &#39;l&#39;, &#39;e&#39;, &#39;e&#39;, &#39;p&#39;, &#39; &#39;, &#39;1&#39;, &#39;0&#39;, &#39;;&#39;, &#39;e&#39;, &#39;c&#39;, &#39;h&#39;, &#39;o&#39;, &#39; &#39;, &#39;a&#39;, &#39;a&#39;, &#39;a&#39;)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span>

<span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;sleep 10;echo aaa&#39;</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">command_execute</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
<span class="n">t</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></code></pre></div>
<p>すると、printされた文字列が
<code>('s', 'l', 'e', 'e', 'p', ' ', '1', '0', ';', 'e', 'c', 'h', 'o', ' ', 'a', 'a', 'a')</code>
となるわけです。
何が起きてるんだ状態です。</p>

<p>調べてみると原因は「<code>args</code>にtupleを渡してあげる」というところにありました。</p>

<h2 id="pythonでtupleをつくる">pythonでtupleをつくる</h2>

<p><code>tuple = (1, 2)</code></p>

<p>基本はこれ。</p>

<p>では、今回のように長さ1のtupleはどうやってつくるか</p>

<h2 id="長さ1のtuple">長さ1のtuple</h2>

<p><code>tuple = (1)</code></p>

<p><strong>普通のpythonist</strong>であればこれは違うとわかるでしょうが、これだと思うでしょう？</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span> <span class="nb">tuple</span> <span class="c1"># 1</span>
<span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span> <span class="c1"># &lt;type &#39;int&#39;&gt;</span></code></pre></div>
<p>なんですよね。</p>

<h3 id="どうするのか">どうするのか</h3>

<p><code>tuple = (1,)</code></p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span>
<span class="k">print</span> <span class="nb">tuple</span> <span class="c1"># (1,)</span>
<span class="k">print</span> <span class="nb">type</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span> <span class="c1"># &lt;type &#39;tuple&#39;&gt;</span></code></pre></div>
<p>こうでした。</p>

<h1 id="けっか">けっか</h1>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">command_execute</span><span class="p">(</span><span class="n">cmd</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">cmd</span> <span class="c1"># sleep 10;echo aaa</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">return</span>

<span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;sleep 10;echo aaa&#39;</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">command_execute</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">cmd</span><span class="p">,))</span>
<span class="n">t</span><span class="o">.</span><span class="n">daemon</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></code></pre></div>
<p>こうしてあげることによって期待通りの動きをしてくれました。</p>

<p>tupleの作り方に注意しなさい的な記述をどこかで見たような気がしたのですが、すっかり失念しておりました。猛省。</p>

            </section>
        </article>
    </main>


    <footer role="contentinfo">
        <div class="hr"></div>
        <div class="footer-link">
            
            <a href="https://twitter.com/yukieroero" target="_blank"><i class="icon-twitter"></i></a>
            <a href="https://facebook.com/yukiyoshiokap" target="_blank"><i class="icon-facebook2"></i></a>
            <a href="https://github.com/pyonk" target="_blank"><i class="icon-github"></i></a>
        </div>
        <div class="copyright">Copyright &copy; pyonk</div>
    </footer>

</div>

<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-85825684-1', 'auto');
    ga('send', 'pageview');
</script>



</body>
</html>

